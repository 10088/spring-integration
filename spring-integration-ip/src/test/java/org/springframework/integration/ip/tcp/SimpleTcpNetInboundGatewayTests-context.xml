<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:ip="http://www.springframework.org/schema/integration/ip"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/integration
			http://www.springframework.org/schema/integration/spring-integration.xsd
			http://www.springframework.org/schema/integration/ip
			http://www.springframework.org/schema/integration/ip/spring-integration-ip.xsd">

	<beans:bean id="tcpIpUtils" class="org.springframework.integration.ip.util.SocketUtils" />

	<ip:inbound-gateway id="gatewayCrLf"
		port="#{tcpIpUtils.findAvailableServerSocket(5200)}"
		request-channel="toSA"
		message-format="crlf" />

	<ip:inbound-gateway id="gatewayStxEtx"
		port="#{tcpIpUtils.findAvailableServerSocket(5300)}"
		request-channel="toSA"
		message-format="stx-etx" />

	<ip:inbound-gateway id="gatewayLength"
		port="#{tcpIpUtils.findAvailableServerSocket(5400)}"
		request-channel="toSA"
		message-format="length-header" />

	<ip:inbound-gateway id="gatewaySerialized"
		port="#{tcpIpUtils.findAvailableServerSocket(5450)}"
		request-channel="toSA"
		message-format="serialized" />

	<ip:inbound-gateway id="gatewayCustom"
		port="#{tcpIpUtils.findAvailableServerSocket(5500)}"
		request-channel="toSA"
		message-format="custom" 
		custom-socket-reader-class-name="org.springframework.integration.ip.tcp.CustomNetSocketReader"
		custom-socket-writer-class-name="org.springframework.integration.ip.tcp.CustomNetSocketWriter"/>

	<channel id="toSA" />
	
	<service-activator id="SA" 
		input-channel="toSA"
		ref="service"
		method="test"
	/>

	<beans:bean id="service" class="org.springframework.integration.ip.tcp.TestService" />

</beans:beans>
